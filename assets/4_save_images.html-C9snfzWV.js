import{_ as r,c,b as e,a as i,e as s,d as n,w as o,r as l,o as d}from"./app-CCtLKDl1.js";const u={};function m(h,a){const t=l("RouteLink"),p=l("CommentService");return d(),c("div",null,[a[7]||(a[7]=e("h1",{id:"case-four-inference-and-save-a-dataset-s-mask-and-label",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#case-four-inference-and-save-a-dataset-s-mask-and-label"},[e("span",null,"Case Four: Inference and Save a Dataset's Mask and Label")])],-1)),a[8]||(a[8]=e("p",null,'We believe that the fastest way to learn is through "Learn by Doing" (learning by doing), so we will help users quickly get started with a few cases.',-1)),a[9]||(a[9]=e("p",null,[n("Overall, IMDL-BenCo assists you in quickly completing the development of image tampering detection research projects through command line calls similar to "),e("code",null,"git"),n(" and "),e("code",null,"conda"),n(". If you have learned front-end technologies like vue, understanding the design paradigm of IMDLBenCo in the same way as vue-cli will be very easy.")],-1)),e("p",null,[a[1]||(a[1]=n("Regardless, please refer to ")),s(t,{to:"/guide/quickstart/install.html"},{default:o(()=>a[0]||(a[0]=[n("Installation")])),_:1}),a[2]||(a[2]=n(" to complete the installation of IMDL-BenCo first."))]),a[10]||(a[10]=i('<div class="hint-container tip"><p class="hint-container-title">Motivation of This Chapter</p><p>In actual engineering development, in addition to metrics, the actual masks and labels are also very important. This chapter will tell you how to easily infer and save these contents for your subsequent use.</p></div><h2 id="update-version" tabindex="-1"><a class="header-anchor" href="#update-version"><span>Update Version</span></a></h2><p>This feature was added in the <a href="https://github.com/scu-zjz/IMDLBenCo/releases/tag/v0.1.36" target="_blank" rel="noopener noreferrer">v0.1.36 version</a> of IMDLBenCo. Please use <code>benco -v</code> to check the version, and update to the latest version if necessary to use the inference feature.</p><h2 id="preparation" tabindex="-1"><a class="header-anchor" href="#preparation"><span>Preparation</span></a></h2><p>First, you need a dataset to be inferred and a model and corresponding checkpoint for inference.</p>',5)),e("ul",null,[e("li",null,[a[4]||(a[4]=n("For the dataset: you can refer to ")),s(t,{to:"/guide/quickstart/0_dataprepare.html"},{default:o(()=>a[3]||(a[3]=[n("Dataset Preparation")])),_:1}),a[5]||(a[5]=n(" to build it."))]),a[6]||(a[6]=e("li",null,[n("For the inference model, you can obtain a checkpoint from your own training or download a checkpoint provided in our "),e("code",null,"model_zoo"),n(".")],-1))]),a[11]||(a[11]=i(`<h2 id="usage" tabindex="-1"><a class="header-anchor" href="#usage"><span>Usage</span></a></h2><p>This feature can be used under <code>benco init</code> and <code>benco init model_zoo</code>. The latest version will generate <a href="https://github.com/scu-zjz/IMDLBenCo/blob/main/IMDLBenCo/training_scripts/test_save_images.py" target="_blank" rel="noopener noreferrer">test_save_images.py</a> in your working path. The <code>--checkpoint_path</code> of this file reads <strong>a specific checkpoint file</strong> (different from test.py which reads a folder containing multiple ckpts) and a well-organized dataset path.</p><p>Inference supports multi-card acceleration. You can refer to the following MVSS-Net inference script to build a shell script to start inference and save:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token assign-left variable">base_dir</span><span class="token operator">=</span><span class="token string">&quot;./save_img_dir_mvss&quot;</span></span>
<span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">\${base_dir}</span></span>
<span class="line"></span>
<span class="line"><span class="token assign-left variable">CUDA_VISIBLE_DEVICES</span><span class="token operator">=</span><span class="token number">0,1</span>,2,3 <span class="token punctuation">\\</span></span>
<span class="line">torchrun  <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">--standalone</span>    <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">--nnodes</span><span class="token operator">=</span><span class="token number">1</span>     <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">--nproc_per_node</span><span class="token operator">=</span><span class="token number">4</span> <span class="token punctuation">\\</span></span>
<span class="line">./save_images.py <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">--model</span> MVSSNet <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">--edge_mask_width</span> <span class="token number">7</span> <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">--world_size</span> <span class="token number">1</span> <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">--test_data_path</span> <span class="token string">&quot;/mnt/data0/public_datasets/IML/CASIA1.0&quot;</span> <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">--checkpoint_path</span> <span class="token string">&quot;/mnt/data0/public_datasets/IML/IMDLBenCo_ckpt/checkpoint-mvss-casiav2.pth&quot;</span> <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">--test_batch_size</span> <span class="token number">2</span> <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">--image_size</span> <span class="token number">512</span> <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">--no_model_eval</span> <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">--if_resizing</span> <span class="token punctuation">\\</span>    <span class="token parameter variable">--output_dir</span> <span class="token variable">\${base_dir}</span>/ <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">--log_dir</span> <span class="token variable">\${base_dir}</span>/ <span class="token punctuation">\\</span></span>
<span class="line"><span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> <span class="token variable">\${base_dir}</span>/error.log <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token variable">\${base_dir}</span>/logs.log</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The framework will automatically resize or remove excess padding based on <code>--if_resizing</code> and <code>--if_padding</code> to ensure that the input images of the dataset and the output masks are the same size. All output images will be saved to the path corresponding to <code>--output_dir</code> according to the file name. Note that <strong>if there are files with the same name in the dataset, they will be overwritten</strong>, so be careful and rename the contents of the dataset if necessary.</p><p>In addition, if the model itself has an <code>image-level</code> output, the framework will first output multiple <code>pred_label_rank{rank}.json</code> based on the number of GPUs, and then merge all these files into a final <code>pred_label_combined.json</code>. This process will also <strong>deduplicate based on file names</strong>. The obtained json file is the model&#39;s predicted probability that each image has been tampered with, which is a floating-point number between 0 and 1, in the following format:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;Sp_D_CND_A_pla0005_pla0023_0281.jpg&quot;</span><span class="token operator">:</span> <span class="token number">0.9999610185623169</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;Sp_D_CNN_A_art0024_ani0032_0268.jpg&quot;</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;Sp_D_CNN_A_nat0085_ani0027_0271.jpg&quot;</span><span class="token operator">:</span> <span class="token number">0.9998431205749512</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;Sp_D_CNN_A_sec0012_ani0007_0275.jpg&quot;</span><span class="token operator">:</span> <span class="token number">0.999996542930603</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;Sp_D_CNN_R_art0017_art0090_0277.jpg&quot;</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;Sp_D_CRN_A_ani0036_ani0066_0372.jpg&quot;</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span></span>
<span class="line">    ...</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If it is a model without <code>image-level</code> output and only performs segmentation, it will not output json by default, only images.</p>`,8)),s(p)])}const b=r(u,[["render",m]]),g=JSON.parse(`{"path":"/guide/quickstart/4_save_images.html","title":"Case Four: Inference and Save a Dataset's Mask and Label","lang":"en-US","frontmatter":{"description":"Case Four: Inference and Save a Dataset's Mask and Label We believe that the fastest way to learn is through \\"Learn by Doing\\" (learning by doing), so we will help users quickly ...","head":[["link",{"rel":"alternate","hreflang":"zh-cn","href":"https://scu-zjz.github.io/IMDLBenCo-doc/IMDLBenCo-doc/zh/guide/quickstart/4_save_images.html"}],["meta",{"property":"og:url","content":"https://scu-zjz.github.io/IMDLBenCo-doc/IMDLBenCo-doc/guide/quickstart/4_save_images.html"}],["meta",{"property":"og:site_name","content":"IMDLBenCo Documentation"}],["meta",{"property":"og:title","content":"Case Four: Inference and Save a Dataset's Mask and Label"}],["meta",{"property":"og:description","content":"Case Four: Inference and Save a Dataset's Mask and Label We believe that the fastest way to learn is through \\"Learn by Doing\\" (learning by doing), so we will help users quickly ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:locale:alternate","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-05-22T13:43:36.000Z"}],["meta",{"property":"article:modified_time","content":"2025-05-22T13:43:36.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Case Four: Inference and Save a Dataset's Mask and Label\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-05-22T13:43:36.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"Update Version","slug":"update-version","link":"#update-version","children":[]},{"level":2,"title":"Preparation","slug":"preparation","link":"#preparation","children":[]},{"level":2,"title":"Usage","slug":"usage","link":"#usage","children":[]}],"git":{"updatedTime":1747921416000,"contributors":[{"name":"Sunnyhaze","username":"Sunnyhaze","email":"mxch1122@126.com","commits":3,"url":"https://github.com/Sunnyhaze"}],"changelog":[{"hash":"e11c28d4fb2ea9379f97109216a361a43dc782d9","time":1747921416000,"email":"mxch1122@126.com","author":"Sunnyhaze","message":"[update] add comment services to case 4 and 5"},{"hash":"1c6f5ddc5a1699f6868598a5077fd120ca28e23a","time":1747542163000,"email":"mxch1122@126.com","author":"Sunnyhaze","message":"[update] add guide for complexity"},{"hash":"0f28991555d603a81ee5afc01a8ed2867b5f60bc","time":1747192936000,"email":"mxch1122@126.com","author":"Sunnyhaze","message":"[update] add demos for inference imags"}]},"filePathRelative":"guide/quickstart/4_save_images.md","autoDesc":true}`);export{b as comp,g as data};
